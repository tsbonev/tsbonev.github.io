(function () {
	const translations = {
		en: {
			// Page title
			'pageTitle': 'Table Planner',
			// Toolbar
			'addCircleTableBtn': 'Add Circular Table',
			'addRectTableBtn': 'Add Rectangular Table',
			'addSeparatorBtn': 'Add Separator',
			'snapToggle': 'Snap',
			'gridSizeInput': 'Grid',
			'showGridToggle': 'Show Grid',
			'undoBtn': 'Undo',
			'redoBtn': 'Redo',
			'exportBtn': 'Export Plan',
			'importBtn': 'Import Plan',
			'printSeatingChartBtn': 'Print Seating Chart',
			'printBtn': 'Print Page',
			'viewToggleBtn': 'Seating Chart',
			'canvasViewBtn': 'Canvas View',
			'recenterBtn': 'Re-center Canvas',

			// Seating Chart
			'seatingChartNoTables': 'No tables to display',
			'tableTypeRound': 'Round',
			'tableTypeRectangle': 'Rectangle',
			'seatsLabel': 'seats',
			'emptySeat': 'Empty seat',
			'assignedLabel': 'assigned',
			'childrenLabel': 'children',
			'colorLabel': 'Color:',

			// Sidebar
			'guestsTitle': 'Guests',
			'legendTitle': 'Color Legend',
			'toggleLegend': 'Toggle Color Legend',
			'exportGuestsCsvBtn': 'Export Guests CSV',
			'importGuestsCsvBtn': 'Import Guests CSV',
			'selectPictureFolderBtn': 'Select Picture Folder',
			'scanPicturesBtn': 'Scan for Pictures',
			'guestNameInput': 'Guest name',
			'guestChildLabel': 'Child',
			'guestFormSubmit': 'Add',
			'guestSortLabel': 'Sort:',
			'guestSortUnassignedFirst': 'Unassigned first',
			'guestSortAssignedFirst': 'Assigned first',
			'guestSortName': 'Name A‚ÄìZ',
			'guestSortColor': 'Color',
			'guestSortChildFirst': 'Children first',
			'guestSortTableSeat': 'Table & Seat',
			'guestUnassignedOnly': 'Unassigned only',
			'guestSearchInput': 'Search guests...',
			'selectedInfo': 'Selected:',
			'tableControlsTitle': 'Selected Table',
			'tableGuestsTitle': 'Table Guests',
			'seatCountLabel': 'Seats:',
			'applySeatCountBtn': 'Apply',
			'oneSidedToggle': 'One-sided (rect only)',
			'seatSideLabel': 'Seat side:',
			'oddExtraSeatLabel': 'Odd extra seat to:',
			'sideTop': 'Top',
			'sideRight': 'Right',
			'sideBottom': 'Bottom',
			'sideLeft': 'Left',

			// Counts
			'tableCount': 'Tables: {count}',
			'seatCount': 'Seats: {count}',
			'guestCounts': 'Total: {total} | Assigned: {assigned} | Unassigned: {unassigned}',

			// Seat assignment popover
			'searchGuests': 'Search guests...',
			'assignBtn': 'Assign',
			'unassignBtn': 'Unassign',

			// Messages
			'deleteTableConfirm': 'Delete table "{label}" with {count} assigned guests?',
			'deleteGuestConfirm': 'Delete this guest and unassign from any seat?',
			'deleteMultipleTablesConfirm': 'Delete {count} selected table(s) with assigned guests?',
			'reduceSeatsConfirm': 'Reducing seats to {seats} will unassign {count} guest(s). Continue?',
			'importFailed': 'Import failed: {error}',
			'importFailedInvalidJson': 'Import failed: invalid JSON',
			'importGuestsFailed': 'Import guests failed: invalid CSV',
			'pictureFolderNotSupported': 'Your browser does not support folder selection. Please use Chrome or Edge for this feature.',
			'pictureFolderSelectFailed': 'Failed to select folder. Please try again.',
			'pictureFolderNotSelected': 'Please select a picture folder first.',
			'pictureScanning': 'Scanning...',
			'pictureScanSuccess': 'Found and assigned {count} picture(s) to guests.',
			'pictureScanNoMatches': 'No matching pictures found. Make sure PNG files have names that match guest names (case-insensitive, spaces/dashes normalized).',
			'pictureScanFailed': 'Failed to scan pictures. Please try again.',
			'pictureRemoveConfirm': 'Remove picture for {name}?',

			// Seat and status text
			'seat': 'Seat',
			'unassigned': 'Unassigned',
			'table': 'Table',
			'tableTitle': 'Table {label}',
			'separatorTitle': 'Separator',
			'seatNumber': 'Seat {number}',
			'toggleSidebar': 'Toggle Sidebar',
			'unitMeter': 'm',
			'tableSizeLabel': 'Size:',
			'tableSizeWidth': 'Width:',
			'tableSizeHeight': 'Height:',
			'tieSizeToCanvasBtn': 'üìè Tie to Canvas',
			'tieSizeToCanvasBtnActive': 'üìè Tied to Canvas',
			'pixelsPerMeterLabel': 'Pixels per meter:',
			'pageText': 'Page',
			'canvasViewTitle': 'Table Layout'
		},
		bg: {
			// Page title
			'pageTitle': '–ü–ª–∞–Ω–∏—Ä–∞–Ω–µ –Ω–∞ –º–∞—Å–∏',
			// Toolbar
			'addCircleTableBtn': '–î–æ–±–∞–≤–∏ –ö—Ä—ä–≥–ª–∞ –ú–∞—Å–∞',
			'addRectTableBtn': '–î–æ–±–∞–≤–∏ –ü—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∞ –ú–∞—Å–∞',
			'addSeparatorBtn': '–î–æ–±–∞–≤–∏ –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª',
			'snapToggle': '–ü—Ä–∏–ª–µ–ø–≤–∞–Ω–µ',
			'gridSizeInput': '–ú—Ä–µ–∂–∞',
			'showGridToggle': '–ü–æ–∫–∞–∂–∏ –ú—Ä–µ–∂–∞',
			'undoBtn': '–û—Ç–º–µ–Ω–∏',
			'redoBtn': '–ü–æ–≤—Ç–æ—Ä–∏',
			'exportBtn': '–ï–∫—Å–ø–æ—Ä—Ç –ü–ª–∞–Ω',
			'importBtn': '–ò–º–ø–æ—Ä—Ç –ü–ª–∞–Ω',
			'printSeatingChartBtn': '–ü–µ—á–∞—Ç –°—Ö–µ–º–∞ –Ω–∞ –ú–µ—Å—Ç–∞—Ç–∞',
			'printBtn': '–ü–µ—á–∞—Ç –°—Ö–µ–º–∞ –Ω–∞ –ú–∞—Å–∏—Ç–µ',
			'viewToggleBtn': '–°—Ö–µ–º–∞ –Ω–∞ –ú–µ—Å—Ç–∞—Ç–∞',
			'canvasViewBtn': '–ò–∑–≥–ª–µ–¥ –Ω–∞ –ö–∞–Ω–≤–∞—Å–∞',
			'recenterBtn': '–¶–µ–Ω—Ç—Ä–∏—Ä–∞–π –ö–∞–Ω–≤–∞—Å–∞',

			// Seating Chart
			'seatingChartNoTables': '–ù—è–º–∞ –º–∞—Å–∏ –∑–∞ –ø–æ–∫–∞–∑–≤–∞–Ω–µ',
			'tableTypeRound': '–ö—Ä—ä–≥–ª–∞',
			'tableTypeRectangle': '–ü—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∞',
			'seatsLabel': '–º–µ—Å—Ç–∞',
			'emptySeat': '–ü—Ä–∞–∑–Ω–æ –º—è—Å—Ç–æ',
			'assignedLabel': '—Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏',
			'childrenLabel': '–¥–µ—Ü–∞',
			'colorLabel': '–¶–≤—è—Ç:',

			// Sidebar
			'guestsTitle': '–ì–æ—Å—Ç–∏',
			'legendTitle': '–õ–µ–≥–µ–Ω–¥–∞ –¶–≤–µ—Ç–æ–≤–µ',
			'toggleLegend': '–ü—Ä–µ–≤–∫–ª—é—á–∏ –õ–µ–≥–µ–Ω–¥–∞ –¶–≤–µ—Ç–æ–≤–µ',
			'exportGuestsCsvBtn': '–ï–∫—Å–ø–æ—Ä—Ç –ì–æ—Å—Ç–∏ CSV',
			'importGuestsCsvBtn': '–ò–º–ø–æ—Ä—Ç –ì–æ—Å—Ç–∏ CSV',
			'selectPictureFolderBtn': '–ò–∑–±–µ—Ä–∏ –ü–∞–ø–∫–∞ —Å—ä—Å –°–Ω–∏–º–∫–∏',
			'scanPicturesBtn': '–°–∫–∞–Ω–∏—Ä–∞–π –∑–∞ –°–Ω–∏–º–∫–∏',
			'guestNameInput': '–ò–º–µ –Ω–∞ –≥–æ—Å—Ç',
			'guestChildLabel': '–î–µ—Ç–µ',
			'guestFormSubmit': '–î–æ–±–∞–≤–∏',
			'guestSortLabel': '–°–æ—Ä—Ç–∏—Ä–∞–Ω–µ:',
			'guestSortUnassignedFirst': '–ù–µ—Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏ –ø—ä—Ä–≤–∏',
			'guestSortAssignedFirst': '–†–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏ –ø—ä—Ä–≤–∏',
			'guestSortName': '–ò–º–µ –ê‚Äì–Ø',
			'guestSortColor': '–¶–≤—è—Ç',
			'guestSortChildFirst': '–î–µ—Ü–∞ –ø—ä—Ä–≤–∏',
			'guestSortTableSeat': '–ú–∞—Å–∞ –∏ –ú—è—Å—Ç–æ',
			'guestUnassignedOnly': '–°–∞–º–æ –Ω–µ—Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏',
			'guestSearchInput': '–¢—ä—Ä—Å–∏ –≥–æ—Å—Ç–∏...',
			'selectedInfo': '–ò–∑–±—Ä–∞–Ω–æ:',
			'tableControlsTitle': '–ò–∑–±—Ä–∞–Ω–∞ –ú–∞—Å–∞',
			'tableGuestsTitle': '–ì–æ—Å—Ç–∏ –Ω–∞ –ú–∞—Å–∞—Ç–∞',
			'seatCountLabel': '–ú–µ—Å—Ç–∞:',
			'applySeatCountBtn': '–ü—Ä–∏–ª–æ–∂–∏',
			'oneSidedToggle': '–ï–¥–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–∞ (—Å–∞–º–æ –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏–∫)',
			'seatSideLabel': '–°—Ç—Ä–∞–Ω–∞ –∑–∞ –º–µ—Å—Ç–∞:',
			'oddExtraSeatLabel': '–ù–µ—á–µ—Ç–Ω–æ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–æ –º—è—Å—Ç–æ –∫—ä–º:',
			'sideTop': '–ì–æ—Ä–µ',
			'sideRight': '–î—è—Å–Ω–æ',
			'sideBottom': '–î–æ–ª—É',
			'sideLeft': '–õ—è–≤–æ',

			// Counts
			'tableCount': '–ú–∞—Å–∏: {count}',
			'seatCount': '–ú–µ—Å—Ç–∞: {count}',
			'guestCounts': '–û–±—â–æ: {total} | –†–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏: {assigned} | –ù–µ—Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏: {unassigned}',

			// Seat assignment popover
			'searchGuests': '–¢—ä—Ä—Å–∏ –≥–æ—Å—Ç–∏...',
			'assignBtn': '–†–∞–∑–ø—Ä–µ–¥–µ–ª–∏',
			'unassignBtn': '–ü—Ä–µ–º–∞—Ö–Ω–∏',

			// Messages
			'deleteTableConfirm': '–ò–∑—Ç—Ä–∏–π –º–∞—Å–∞ "{label}" —Å {count} —Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏ –≥–æ—Å—Ç–∏?',
			'deleteGuestConfirm': '–ò–∑—Ç—Ä–∏–π —Ç–æ–∑–∏ –≥–æ—Å—Ç –∏ –ø—Ä–µ–º–∞—Ö–Ω–∏ –æ—Ç –≤—Å—è–∫–æ –º—è—Å—Ç–æ?',
			'deleteMultipleTablesConfirm': '–ò–∑—Ç—Ä–∏–π {count} –∏–∑–±—Ä–∞–Ω–∏ –º–∞—Å–∏ —Å —Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω–∏ –≥–æ—Å—Ç–∏?',
			'reduceSeatsConfirm': '–ù–∞–º–∞–ª—è–≤–∞–Ω–µ—Ç–æ –Ω–∞ –º–µ—Å—Ç–∞—Ç–∞ –¥–æ {seats} —â–µ –ø—Ä–µ–º–∞—Ö–Ω–µ {count} –≥–æ—Å—Ç(–∞). –ü—Ä–æ–¥—ä–ª–∂–∏?',
			'importFailed': '–ò–º–ø–æ—Ä—Ç –Ω–µ—É—Å–ø–µ—à–µ–Ω: {error}',
			'importFailedInvalidJson': '–ò–º–ø–æ—Ä—Ç –Ω–µ—É—Å–ø–µ—à–µ–Ω: –Ω–µ–≤–∞–ª–∏–¥–µ–Ω JSON',
			'importGuestsFailed': '–ò–º–ø–æ—Ä—Ç –Ω–∞ –≥–æ—Å—Ç–∏ –Ω–µ—É—Å–ø–µ—à–µ–Ω: –Ω–µ–≤–∞–ª–∏–¥–µ–Ω CSV',
			'pictureFolderNotSupported': '–í–∞—à–∏—è—Ç –±—Ä–∞—É–∑—ä—Ä –Ω–µ –ø–æ–¥–¥—ä—Ä–∂–∞ –∏–∑–±–æ—Ä –Ω–∞ –ø–∞–ø–∫–∞. –ú–æ–ª—è –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ Chrome –∏–ª–∏ Edge –∑–∞ —Ç–∞–∑–∏ —Ñ—É–Ω–∫—Ü–∏—è.',
			'pictureFolderSelectFailed': '–ù–µ—É—Å–ø–µ—à–µ–Ω –∏–∑–±–æ—Ä –Ω–∞ –ø–∞–ø–∫–∞. –ú–æ–ª—è –æ–ø–∏—Ç–∞–π—Ç–µ –æ—Ç–Ω–æ–≤–æ.',
			'pictureFolderNotSelected': '–ú–æ–ª—è –ø—ä—Ä–≤–æ –∏–∑–±–µ—Ä–µ—Ç–µ –ø–∞–ø–∫–∞ —Å—ä—Å —Å–Ω–∏–º–∫–∏.',
			'pictureScanning': '–°–∫–∞–Ω–∏—Ä–∞–Ω–µ...',
			'pictureScanSuccess': '–ù–∞–º–µ—Ä–µ–Ω–∏ –∏ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏ {count} —Å–Ω–∏–º–∫–∞(–∏) –Ω–∞ –≥–æ—Å—Ç–∏.',
			'pictureScanNoMatches': '–ù–µ —Å–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ —Å—ä–æ—Ç–≤–µ—Ç—Å—Ç–≤–∞—â–∏ —Å–Ω–∏–º–∫–∏. –£–≤–µ—Ä–µ—Ç–µ —Å–µ, —á–µ PNG —Ñ–∞–π–ª–æ–≤–µ—Ç–µ –∏–º–∞—Ç –∏–º–µ–Ω–∞, –∫–æ–∏—Ç–æ —Å—ä–æ—Ç–≤–µ—Ç—Å—Ç–≤–∞—Ç –Ω–∞ –∏–º–µ–Ω–∞—Ç–∞ –Ω–∞ –≥–æ—Å—Ç–∏—Ç–µ (–±–µ–∑ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—ä—Ä–∞, –∏–Ω—Ç–µ—Ä–≤–∞–ª–∏—Ç–µ/—Ç–∏—Ä–µ—Ç–∞—Ç–∞ —Å–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∏—Ä–∞—Ç).',
			'pictureScanFailed': '–ù–µ—É—Å–ø–µ—à–Ω–æ —Å–∫–∞–Ω–∏—Ä–∞–Ω–µ –Ω–∞ —Å–Ω–∏–º–∫–∏. –ú–æ–ª—è –æ–ø–∏—Ç–∞–π—Ç–µ –æ—Ç–Ω–æ–≤–æ.',
			'pictureRemoveConfirm': '–ü—Ä–µ–º–∞—Ö–Ω–∏ —Å–Ω–∏–º–∫–∞—Ç–∞ –∑–∞ {name}?',

			// Seat and status text
			'seat': '–ú—è—Å—Ç–æ',
			'unassigned': '–ù–µ—Ä–∞–∑–ø—Ä–µ–¥–µ–ª–µ–Ω',
			'table': '–ú–∞—Å–∞',
			'tableTitle': '–ú–∞—Å–∞ {label}',
			'separatorTitle': '–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª',
			'seatNumber': '–ú—è—Å—Ç–æ {number}',
			'toggleSidebar': '–ü—Ä–µ–≤–∫–ª—é—á–∏ –°—Ç—Ä–∞–Ω–∏—á–Ω–∞—Ç–∞ –õ–µ–Ω—Ç–∞',
			'unitMeter': '–º',
			'tableSizeLabel': '–†–∞–∑–º–µ—Ä:',
			'tableSizeWidth': '–®–∏—Ä–∏–Ω–∞:',
			'tableSizeHeight': '–í–∏—Å–æ—á–∏–Ω–∞:',
			'tieSizeToCanvasBtn': 'üìè –°–≤—ä—Ä–∂–∏ —Å Canvas',
			'tieSizeToCanvasBtnActive': 'üìè –°–≤—ä—Ä–∑–∞–Ω–æ —Å Canvas',
			'pixelsPerMeterLabel': '–ü–∏–∫—Å–µ–ª–∏ –Ω–∞ –º–µ—Ç—ä—Ä:',
			'pageText': '–°—Ç—Ä–∞–Ω–∏—Ü–∞',
			'canvasViewTitle': '–°—Ö–µ–º–∞ –Ω–∞ –º–∞—Å–∏—Ç–µ'
		}
	};

	function t(key, params = {}) {
		const lang = window.TablePlanner?.state?.ui?.language || 'en';
		let text = translations[lang]?.[key] || translations.en[key] || key;

		// Simple parameter replacement
		for (const [param, value] of Object.entries(params)) {
			text = text.replace(new RegExp(`{${param}}`, 'g'), value);
		}

		return text;
	}

	function updateUI() {
		const lang = window.TablePlanner?.state?.ui?.language || 'en';

		// Update page title
		const titleEl = document.querySelector('title[data-i18n]');
		if (titleEl) {
			const key = titleEl.getAttribute('data-i18n');
			document.title = t(key);
		}

		// Update all elements with data-i18n attributes
		document.querySelectorAll('[data-i18n]').forEach(el => {
			const key = el.getAttribute('data-i18n');
			if (el.tagName === 'INPUT' && el.type === 'submit') {
				el.value = t(key);
			} else if (el.tagName === 'INPUT' && (el.type === 'text' || el.type === 'number')) {
				el.placeholder = t(key);
			} else if (el.tagName !== 'TITLE') { // Skip title as it's handled above
				el.textContent = t(key);
			}
		});

		// Update elements with data-i18n-attr attributes
		document.querySelectorAll('[data-i18n-attr]').forEach(el => {
			const [attr, key] = el.getAttribute('data-i18n-attr').split(':');
			el.setAttribute(attr, t(key));
		});

		// Update counts and dynamic content
		if (window.updateCounts) window.updateCounts();
	}

	window.i18n = { t, updateUI };
})();
